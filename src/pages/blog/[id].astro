---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import FormattedDate from '@/components/FormattedDate.astro';
import Base from '@/layouts/Base.astro';
import Back from '@/components/Back.astro';
import Comments from '@/components/Comments.astro';

export async function getStaticPaths() {
  const blog = await getCollection('blog');
  return blog.map((post) => ({
    params: { id: post.id },
    props: post,
  }));
}
type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content } = await render(post);
const { title, description, pubDate } = post.data;
---

<Base title={title} description={description}>
  <main class="container mx-auto my-8 max-w-4xl px-4">
    <div class="mb-8">
      <Back href="/blog">Blog</Back>

      <header class="space-y-4">
        <div>
          <FormattedDate
            date={pubDate}
            class="bg-trans-blue/15 text-trans-blue-dark rounded-full px-4 py-2 text-sm font-medium"
          />
        </div>

        <h1
          class="from-trans-pink via-trans-blue to-soft-lavender mb-4 bg-gradient-to-r bg-clip-text text-3xl leading-tight font-bold text-transparent md:text-4xl lg:text-5xl"
        >
          {title}
        </h1>

        <div
          class="border-trans-pink/15 from-trans-pink/8 to-trans-blue/8 rounded-xl border bg-gradient-to-r p-6"
        >
          <p class="text-warm-gray-800 text-lg leading-relaxed font-medium">
            {description}
          </p>
        </div>
      </header>
    </div>

    <article
      class="prose prose-lg prose-headings:font-bold prose-headings:text-warm-gray-900 prose-p:text-warm-gray-700 prose-p:leading-relaxed prose-strong:font-semibold prose-strong:text-trans-blue-dark prose-code:rounded prose-code:bg-trans-pink/15 prose-code:px-2 prose-code:py-1 prose-code:text-trans-pink-dark prose-code:font-medium prose-pre:rounded-lg prose-pre:border prose-pre:border-warm-gray-200 prose-pre:bg-warm-gray-50 prose-blockquote:border-l-4 prose-blockquote:border-trans-pink prose-blockquote:bg-trans-pink/8 prose-blockquote:pl-6 prose-blockquote:font-medium prose-a:text-trans-blue-dark prose-a:font-medium hover:prose-a:text-hover-blue max-w-none"
    >
      <Content />

      <!-- Separator before comments -->
      <div class="my-12">
        <div class="bg-warm-gray-200 h-px"></div>
      </div>

      <Comments />
    </article>
  </main>
</Base>
